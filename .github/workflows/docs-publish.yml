name: Publish Documentation

on:
  push:
    branches: [main]
    paths:
      - 'docs/**'
      - '.readthedocs.yaml'
      - '.github/workflows/docs-publish.yml'
  workflow_dispatch:  # Allow manual trigger

jobs:
  verify-rtd:
    name: Verify Read the Docs Configuration
    runs-on: ubuntu-22.04
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Validate .readthedocs.yaml
        run: |
          if [ ! -f .readthedocs.yaml ]; then
            echo "::error::Missing .readthedocs.yaml configuration file"
            exit 1
          fi
          
          python3 -c "import yaml; yaml.safe_load(open('.readthedocs.yaml'))"
          echo "âœ… RTD configuration is valid"
      
      - name: Check documentation builds
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      
      - name: Test build
        run: |
          sudo apt-get update && sudo apt-get install -y python3-venv
          cd docs && make install && make html
          echo "âœ… Documentation builds successfully"
  
  publish-info:
    name: Documentation Publishing Info
    runs-on: ubuntu-22.04
    needs: verify-rtd
    
    steps:
      - name: Output publishing info
        run: |
          cat << 'EOF'
          
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘                     ðŸ“– DOCUMENTATION PUBLISHING                              â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          Documentation is published via Read the Docs at:
          
            ðŸŒ https://canonical-chopsticks.readthedocs-hosted.com
          
          Read the Docs automatically builds documentation when:
            âœ“ Changes are pushed to main branch
            âœ“ Changes affect docs/ directory or .readthedocs.yaml
            âœ“ Pull requests are created (preview builds)
          
          Configuration:
            â€¢ Build config: .readthedocs.yaml
            â€¢ Python version: 3.12
            â€¢ Builder: Sphinx (dirhtml)
            â€¢ Theme: Canonical Sphinx (Furo-based)
            
          Build status:
            â€¢ Check: https://readthedocs.org/projects/canonical-chopsticks/builds/
            
          Documentation structure (DiÃ¡taxis):
            ðŸ“˜ Tutorial      - Learning-oriented guides
            ðŸ“— How-to        - Task-oriented guides
            ðŸ“™ Reference     - Information-oriented specs
            ðŸ“• Explanation   - Understanding-oriented concepts
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          Note: Read the Docs provides:
            âœ“ Automatic builds on push
            âœ“ PR preview builds
            âœ“ Version management
            âœ“ Search functionality
            âœ“ PDF/EPUB downloads
            âœ“ Canonical subdomain (canonical-chopsticks.readthedocs-hosted.com)
          
          EOF
          
          echo "::notice::Documentation will be available at https://canonical-chopsticks.readthedocs-hosted.com"
